import{u as j,i as q}from"./action-C7K6-RGR.js";import{d as J,y as K,I,c as k,w as a,r as u,B as M,f as c,A as S,k as v,v as s,s as m,aK as H,j as d,R as O,q as G,F as $,n as V,l as w,ad as P,aL as Q,aM as X}from"./tool-cO2MwZWv.js";import"./modulepreload-polyfill-B5Qt9EMX.js";const Y={class:"ctool-page-option"},Z={class:"ctool-websocket-logs-item"},ee={class:"ctool-websocket-logs-top"},te={class:"ctool-websocket-logs-time"},oe={class:"ctool-websocket-logs-content"},le=J({__name:"Websocket",async setup(se){let b,C;const l=j(([b,C]=K(()=>q({input:"wss://echo.websocket.events",keepScroll:!0,protocols:""},{paste:e=>/^ws/.test(e)})),b=await b,C(),b));let _=I(!1),g=0,y=!1,z;const o=I({status:"close",ws:null,send_content:"",logs:[]}),i=async(e,t="other")=>{if(o.value.logs.push({content:e,type:t,time:P().format("HH:mm:ss")}),await Q(),l.current.keepScroll){const p=document.querySelector(".ctool-websocket-logs .ctool-card-body");p&&(p.scrollTop=p.scrollHeight)}},h=()=>{if(!(!l.current.input.trim()||o.value.status!=="close")){o.value.status="connecting",l.save(),i($t("websocket_connect_start",[l.current.input]));try{let e=new WebSocket(l.current.input,l.current.protocols!==""?l.current.protocols.split(","):void 0);console.log(e),e.addEventListener("open",t=>{console.log(t),o.value.status="open",E(),i($t("websocket_connect_ok"))}),e.addEventListener("close",t=>{if(console.log(t),o.value.status="close",i($t("websocket_close_ok")),_.value){if(y)return;y=!0,z=setInterval(()=>{o.value.status==="close"&&(g=g+1,i(`${$t("websocket_reconnect")} ${g}`),h())},3e3)}}),e.addEventListener("message",t=>{console.log(t),i(t.data,"accept")}),e.addEventListener("error",t=>{console.log(t),i("Websocket Error")}),o.value.ws=e}catch(e){console.log(e),i($error(e))}}},L=()=>{var e;_.value=!1,E(),i($t("websocket_close_start",[l.current.input])),(e=o.value.ws)==null||e.close()},E=()=>{g=0,y=!1,clearInterval(z)},A=()=>{var e;if(o.value.status!=="open")throw new Error($t("websocket_error_connect"));if(o.value.send_content==="")throw new Error($t("websocket_error_content"));try{(e=o.value.ws)==null||e.send(o.value.send_content),i(o.value.send_content,"send")}catch(t){i($error(t))}};return(e,t)=>{const p=u("Align"),T=u("Bool"),x=u("Input"),R=u("HelpTip"),f=u("Button"),U=u("Textarea"),N=u("Exception"),W=u("Icon"),D=u("Card"),F=u("HeightResize"),B=M("row");return c(),k(p,{direction:"vertical"},{default:a(()=>[S((c(),v("div",Y,[s(x,{modelValue:d(l).current.input,"onUpdate:modelValue":t[1]||(t[1]=r=>d(l).current.input=r)},{prepend:a(()=>[s(p,{horizontal:"center",vertical:"center",width:20},{default:a(()=>[m("div",{class:H(["ctool-websocket-status",[`ctool-websocket-status-${o.value.status}`]])},null,2)]),_:1})]),suffix:a(()=>[s(T,{size:"small",modelValue:d(_),"onUpdate:modelValue":t[0]||(t[0]=r=>O(_)?_.value=r:_=r),label:e.$t("websocket_reconnect")},null,8,["modelValue","label"])]),_:1},8,["modelValue"]),s(x,{modelValue:d(l).current.protocols,"onUpdate:modelValue":t[2]||(t[2]=r=>d(l).current.protocols=r),label:e.$t("websocket_protocols")},{suffix:a(()=>[s(R,{text:e.$t("websocket_protocols_tip")},null,8,["text"])]),_:1},8,["modelValue","label"]),o.value.status==="close"?(c(),k(f,{key:0,onClick:t[3]||(t[3]=r=>h()),text:e.$t("websocket_connect")},null,8,["text"])):(c(),k(f,{key:1,onClick:t[4]||(t[4]=r=>L()),text:e.$t("websocket_close")},null,8,["text"]))])),[[B,"16-8-auto"]]),S((c(),k(F,{ignore:"",reduce:5,append:[".ctool-page-option"]},{default:a(({height:r})=>[s(U,{height:r,modelValue:o.value.send_content,"onUpdate:modelValue":t[5]||(t[5]=n=>o.value.send_content=n),"float-text":e.$t("websocket_send"),"float-position":"top-right",onClickFloatText:A,placeholder:`${e.$t("main_ui_input")}${e.$t("websocket_send_content")}`},null,8,["height","modelValue","float-text","placeholder"]),s(D,{title:e.$t("websocket_log_content"),height:r,class:"ctool-websocket-logs"},{extra:a(()=>[s(p,null,{default:a(()=>[s(f,{size:"small",type:"primary",text:e.$t("main_ui_copy"),onClick:t[6]||(t[6]=()=>e.$copy(JSON.stringify(o.value.logs)))},null,8,["text"]),s(f,{size:"small",type:"danger",text:e.$t("main_ui_clear"),onClick:t[7]||(t[7]=n=>o.value.logs=[])},null,8,["text"]),s(T,{size:"small",modelValue:d(l).current.keepScroll,"onUpdate:modelValue":t[8]||(t[8]=n=>d(l).current.keepScroll=n),border:"",label:e.$t("websocket_keep_scroll"),onChange:t[9]||(t[9]=n=>d(l).save())},null,8,["modelValue","label"])]),_:1})]),default:a(()=>[o.value.logs.length<1?(c(),k(p,{key:0,horizontal:"center",vertical:"center"},{default:a(()=>[s(N)]),_:1})):(c(),k(p,{key:1,direction:"vertical"},{default:a(()=>[(c(!0),v($,null,G(o.value.logs,n=>(c(),v("div",Z,[m("div",ee,[m("div",{class:H(["ctool-websocket-logs-type",`ctool-websocket-logs-type-${n.type}`])},[n.type==="send"?(c(),v($,{key:0},[V(w(e.$t("websocket_client"))+"：",1)],64)):n.type==="accept"?(c(),v($,{key:1},[V(w(e.$t("websocket_server"))+"：",1)],64)):(c(),v($,{key:2},[V(w(e.$t("websocket_tips"))+"：",1)],64))],2),m("div",te,w(n.time),1),s(W,{size:12,name:"copy",tooltip:e.$t("main_ui_copy"),hover:"",onClick:ne=>e.$copy(n.content)},null,8,["tooltip","onClick"])]),m("pre",oe,[m("code",null,w(n.content),1)])]))),256))]),_:1}))]),_:2},1032,["title","height"])]),_:1})),[[B,"40-60"]])]),_:1})}}}),ie=X(le,[["__scopeId","data-v-992100fd"]]);export{ie as default};
