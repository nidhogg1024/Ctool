import{u as j,i as q}from"./action-BZ3Nddn_.js";import{d as J,L as O,A as I,c as k,w as a,r as u,N as S,k as m,x as l,al as P,j as d,v,I as H,q as G,F as $,n as V,l as w,aa as K,ay as M,P as Q,a as c,az as X}from"./tool-BLEDneDs.js";import"./modulepreload-polyfill-B5Qt9EMX.js";import"./vendor-mathjs-__1x7LJv.js";import"./vendor-monaco-DSX5bDTJ.js";import"./vendor-lodash-rhkwYG98.js";const Y={class:"ctool-page-option"},Z={class:"ctool-websocket-logs-item"},ee={class:"ctool-websocket-logs-top"},te={class:"ctool-websocket-logs-time"},oe={class:"ctool-websocket-logs-content"},se=J({__name:"Websocket",async setup(le){let b,C;const s=j(([b,C]=O(()=>q({input:"wss://echo.websocket.events",keepScroll:!0,protocols:""},{paste:e=>e.startsWith("ws")})),b=await b,C(),b));let _=I(!1),g=0,y=!1,z;const o=I({status:"close",ws:null,send_content:"",logs:[]}),i=async(e,t="other")=>{if(o.value.logs.push({content:e,type:t,time:K().format("HH:mm:ss")}),await M(),s.current.keepScroll){const p=document.querySelector(".ctool-websocket-logs .ctool-card-body");p&&(p.scrollTop=p.scrollHeight)}},h=()=>{if(!(!s.current.input.trim()||o.value.status!=="close")){o.value.status="connecting",s.save(),i($t("websocket_connect_start",[s.current.input]));try{const e=new WebSocket(s.current.input,s.current.protocols!==""?s.current.protocols.split(","):void 0);console.log(e),e.addEventListener("open",t=>{console.log(t),o.value.status="open",x(),i($t("websocket_connect_ok"))}),e.addEventListener("close",t=>{if(console.log(t),o.value.status="close",i($t("websocket_close_ok")),_.value){if(y)return;y=!0,z=setInterval(()=>{o.value.status==="close"&&(g=g+1,i(`${$t("websocket_reconnect")} ${g}`),h())},3e3)}}),e.addEventListener("message",t=>{console.log(t),i(t.data,"accept")}),e.addEventListener("error",t=>{console.log(t),i("Websocket Error")}),o.value.ws=e}catch(e){console.log(e),i($error(e))}}},L=()=>{var e;_.value=!1,x(),i($t("websocket_close_start",[s.current.input])),(e=o.value.ws)==null||e.close()},x=()=>{g=0,y=!1,clearInterval(z)},A=()=>{var e;if(o.value.status!=="open")throw new Error($t("websocket_error_connect"));if(o.value.send_content==="")throw new Error($t("websocket_error_content"));try{(e=o.value.ws)==null||e.send(o.value.send_content),i(o.value.send_content,"send")}catch(t){i($error(t))}};return(e,t)=>{const p=u("Align"),E=u("Bool"),T=u("Input"),N=u("HelpTip"),f=u("Button"),U=u("Textarea"),W=u("Exception"),R=u("Icon"),D=u("Card"),F=u("HeightResize"),B=Q("row");return c(),k(p,{direction:"vertical"},{default:a(()=>[S((c(),m("div",Y,[l(T,{modelValue:d(s).current.input,"onUpdate:modelValue":t[1]||(t[1]=r=>d(s).current.input=r)},{prepend:a(()=>[l(p,{horizontal:"center",vertical:"center",width:20},{default:a(()=>[v("div",{class:H(["ctool-websocket-status",[`ctool-websocket-status-${o.value.status}`]])},null,2)]),_:1})]),suffix:a(()=>[l(E,{size:"small",modelValue:d(_),"onUpdate:modelValue":t[0]||(t[0]=r=>P(_)?_.value=r:_=r),label:e.$t("websocket_reconnect")},null,8,["modelValue","label"])]),_:1},8,["modelValue"]),l(T,{modelValue:d(s).current.protocols,"onUpdate:modelValue":t[2]||(t[2]=r=>d(s).current.protocols=r),label:e.$t("websocket_protocols")},{suffix:a(()=>[l(N,{text:e.$t("websocket_protocols_tip")},null,8,["text"])]),_:1},8,["modelValue","label"]),o.value.status==="close"?(c(),k(f,{key:0,onClick:t[3]||(t[3]=r=>h()),text:e.$t("websocket_connect")},null,8,["text"])):(c(),k(f,{key:1,onClick:t[4]||(t[4]=r=>L()),text:e.$t("websocket_close")},null,8,["text"]))])),[[B,"16-8-auto"]]),S((c(),k(F,{ignore:"",reduce:5,append:[".ctool-page-option"]},{default:a(({height:r})=>[l(U,{height:r,modelValue:o.value.send_content,"onUpdate:modelValue":t[5]||(t[5]=n=>o.value.send_content=n),"float-text":e.$t("websocket_send"),"float-position":"top-right",onClickFloatText:A,placeholder:`${e.$t("main_ui_input")}${e.$t("websocket_send_content")}`},null,8,["height","modelValue","float-text","placeholder"]),l(D,{title:e.$t("websocket_log_content"),height:r,class:"ctool-websocket-logs"},{extra:a(()=>[l(p,null,{default:a(()=>[l(f,{size:"small",type:"primary",text:e.$t("main_ui_copy"),onClick:t[6]||(t[6]=()=>e.$copy(JSON.stringify(o.value.logs)))},null,8,["text"]),l(f,{size:"small",type:"danger",text:e.$t("main_ui_clear"),onClick:t[7]||(t[7]=n=>o.value.logs=[])},null,8,["text"]),l(E,{size:"small",modelValue:d(s).current.keepScroll,"onUpdate:modelValue":t[8]||(t[8]=n=>d(s).current.keepScroll=n),border:"",label:e.$t("websocket_keep_scroll"),onChange:t[9]||(t[9]=n=>d(s).save())},null,8,["modelValue","label"])]),_:1})]),default:a(()=>[o.value.logs.length<1?(c(),k(p,{key:0,horizontal:"center",vertical:"center"},{default:a(()=>[l(W)]),_:1})):(c(),k(p,{key:1,direction:"vertical"},{default:a(()=>[(c(!0),m($,null,G(o.value.logs,n=>(c(),m("div",Z,[v("div",ee,[v("div",{class:H(["ctool-websocket-logs-type",`ctool-websocket-logs-type-${n.type}`])},[n.type==="send"?(c(),m($,{key:0},[V(w(e.$t("websocket_client"))+"：",1)],64)):n.type==="accept"?(c(),m($,{key:1},[V(w(e.$t("websocket_server"))+"：",1)],64)):(c(),m($,{key:2},[V(w(e.$t("websocket_tips"))+"：",1)],64))],2),v("div",te,w(n.time),1),l(R,{size:12,name:"copy",tooltip:e.$t("main_ui_copy"),hover:"",onClick:ne=>e.$copy(n.content)},null,8,["tooltip","onClick"])]),v("pre",oe,[v("code",null,w(n.content),1)])]))),256))]),_:1}))]),_:2},1032,["title","height"])]),_:1})),[[B,"40-60"]])]),_:1})}}}),de=X(se,[["__scopeId","data-v-3a307478"]]);export{de as default};
