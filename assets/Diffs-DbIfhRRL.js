import{u as W,i as H}from"./action-Cxqu3Rt-.js";import{d as I,aq as P,ar as N,as as A,I as p,a1 as j,o as q,h as F,H as G,D as L,r as b,f as S,c as $,w as _,v,$ as J,s as K,W as Q,j as f,at as X,au as Y,av as Z,aw as ee,ax as O,ay as te,y as ae,z as le,m as ie,az as ne,M as U}from"./tool-BigAg8GC.js";import"./modulepreload-polyfill-B5Qt9EMX.js";const oe=I({__name:"Diff",props:P({toolbar:{type:String,default:"bottom-right"},lang:{type:String,default:"text"},height:{type:[String,Number],default:"100%"},disableLineWrapping:{type:Boolean,default:!1},disableBorder:{type:Boolean,default:!1},disableLineNumbers:{type:Boolean,default:!1},disableClear:{type:Boolean,default:!1}},{original:{default:""},originalModifiers:{},modified:{default:""},modifiedModifiers:{}}),emits:["update:original","update:modified"],setup(M,{expose:E}){const c=N(M,"original"),m=N(M,"modified"),l=M,V=A(),C=p(null),e=j(null),o=p(!l.disableLineWrapping),w=p(!l.disableLineNumbers),u=p(0),g=p(1),h=p(!1),r=p(!1),k=async()=>{var a;e.value&&([e.value.getOriginalEditor(),e.value.getModifiedEditor()].forEach(t=>{var d;const n=t.getModel();n&&((d=O())==null||d.editor.setModelLanguage(n,te(l.lang).id))}),e.value.updateOptions({renderSideBySide:!h.value,hideUnchangedRegions:{enabled:r.value}}),(a=O())==null||a.editor.setTheme(V.theme.raw==="dark"?"vs-dark":"vs"))},R=async a=>{e.value&&e.value.dispose(),Y({"vs/nls":{availableLanguages:{"*":$t("main_locale")==="zh_CN"?"zh-cn":"en"}}}).then(t=>{const n=t.editor.createModel(c.value),d=t.editor.createModel(m.value),i=t.editor.createDiffEditor(a,{lineNumbers:w.value?"on":"off",wordWrap:o.value?"on":"off",minimap:{enabled:!1},automaticLayout:!0,originalEditable:!0,scrollBeyondLastLine:!1,renderSideBySide:!h.value,enableSplitViewResizing:!1,hideUnchangedRegions:{enabled:r.value},scrollbar:{verticalScrollbarSize:5}});window._diffEditor=i,i.setModel({original:n,modified:d}),i.getOriginalEditor().onDidChangeModelContent(()=>{i.getOriginalEditor().getValue()!==c.value&&(c.value=i.getOriginalEditor().getValue())}),i.getModifiedEditor().onDidChangeModelContent(()=>{i.getModifiedEditor().getValue()!==m.value&&(m.value=i.getModifiedEditor().getValue())}),[i.getOriginalEditor(),i.getModifiedEditor()].forEach(s=>{new Z($t("main_ui_input"),s);const B=new ee(s);B.setHandle("ctool_line_wrapping",(y,T,z)=>o.value=z),B.setHandle("ctool_line_number",(y,T,z)=>w.value=z)}),i.onDidUpdateDiff(()=>{var s;u.value=((s=i.getLineChanges())==null?void 0:s.length)||0,g.value=1}),e.value=i,k()})},D=a=>{var i,s;const t=((i=e.value)==null?void 0:i.getLineChanges())||[];let n=a==="prev"?g.value-1:g.value+1;const d=t.at(n-1);d&&((s=e.value)==null||s.revealLineInCenter(d.originalEndLineNumber),g.value=n)};E({beautifyBoth:async a=>{if(!e.value)return;const t=e.value.getOriginalEditor().getValue(),n=e.value.getModifiedEditor().getValue(),[d,i]=await Promise.all([t?a(l.lang,t):Promise.resolve(t),n?a(l.lang,n):Promise.resolve(n)]);c.value=d,m.value=i}}),q(async()=>{!l.disableClear&&F.addListener("content_clear",()=>x()),await R(C.value)}),G(()=>{var a;return(a=e.value)==null?void 0:a.dispose()});const x=(a="",t="")=>{e.value&&(e.value.getOriginalEditor().getValue()!==a&&e.value.getOriginalEditor().setValue(a),e.value.getModifiedEditor().getValue()!==t&&e.value.getModifiedEditor().setValue(t))};return L(()=>({original:c.value,modified:m.value}),a=>{if(e.value)return x(a.original,a.modified);const t=setInterval(()=>{e.value&&clearInterval(t),x(a.original,a.modified)},50)}),L(()=>({color:V.theme.raw,lang:l.lang,inline:h.value,collapse:r.value}),()=>k()),(a,t)=>{const n=b("Button"),d=b("Input"),i=b("Bool"),s=b("Align"),B=b("Display");return S(),$(B,{position:l.toolbar,right:35,class:"ctool-code-diff",style:Q({height:`${f(X)(l.height)}`,width:"100%"}),toggle:""},{extra:_(()=>[v(s,null,{default:_(()=>[v(d,{size:"small",center:"",disabled:u.value===0,"model-value":`${u.value?g.value:0} / ${u.value}`,width:110},{prepend:_(()=>[v(n,{disabled:u.value===0||g.value===1,text:"<",onClick:t[0]||(t[0]=y=>D("prev"))},null,8,["disabled"])]),append:_(()=>[v(n,{disabled:u.value===0||g.value===u.value,text:">",onClick:t[1]||(t[1]=y=>D("next"))},null,8,["disabled"])]),_:1},8,["disabled","model-value"]),v(i,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=y=>r.value=y),label:a.$t("diffs_collapse"),size:"small",border:""},null,8,["modelValue","label"]),v(i,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=y=>h.value=y),label:a.$t("component_editor_inline"),size:"small",border:""},null,8,["modelValue","label"]),J(a.$slots,"default")]),_:3})]),default:_(()=>[K("div",{ref_key:"container",ref:C,style:{height:"100%",width:"100%"}},null,512)]),_:3},8,["position","style"])}}}),ge=I({__name:"Diffs",async setup(M){let E,c;const m=p(null),l=W(([E,c]=ae(()=>H({original:"",modified:"",option:{lang:"Text"}},{paste:!1})),E=await E,c(),E)),V=le(()=>U.isEnable(l.current.option.lang,"beautify")),C=async()=>{var e;await((e=m.value)==null?void 0:e.beautifyBoth(async(o,w)=>await U.simple(o,"beautify",w)))};return L(()=>l.current,()=>{l.current.original===""||l.current.modified===""||l.save()},{deep:!0}),(e,o)=>{const w=b("Button"),u=b("Select"),g=b("HeightResize");return S(),$(g,null,{default:_(({height:h})=>[v(oe,{ref_key:"diffRef",ref:m,original:f(l).current.original,"onUpdate:original":o[1]||(o[1]=r=>f(l).current.original=r),modified:f(l).current.modified,"onUpdate:modified":o[2]||(o[2]=r=>f(l).current.modified=r),lang:f(l).current.option.lang,height:`${h}px`},{default:_(()=>[V.value?(S(),$(w,{key:0,size:"small",text:e.$t("code_beautify"),onClick:C},null,8,["text"])):ie("",!0),v(u,{size:"small",modelValue:f(l).current.option.lang,"onUpdate:modelValue":o[0]||(o[0]=r=>f(l).current.option.lang=r),options:f(ne),filterable:"",filterPlaceholder:"Search language..."},null,8,["modelValue","options"])]),_:2},1032,["original","modified","lang","height"])]),_:1})}}});export{ge as default};
