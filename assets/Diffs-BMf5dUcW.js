import{u as A,i as H}from"./action-BZ3Nddn_.js";import{d as R,y as N,z as P,A as p,B as W,o as j,h as G,C as J,D as z,c as S,G as K,j as f,H as q,w as _,v as F,x as v,E as Q,J as X,r as b,a as $,K as Y,L as Z,M as ee,V as O,m as te,an as ae}from"./tool-BLEDneDs.js";import{a as ie,P as le,c as ne,m as U}from"./placeholderContentWidget-BgJjAnod.js";import"./modulepreload-polyfill-B5Qt9EMX.js";import"./vendor-mathjs-__1x7LJv.js";import"./vendor-monaco-DSX5bDTJ.js";import"./vendor-lodash-rhkwYG98.js";const oe=R({__name:"Diff",props:X({toolbar:{type:String,default:"bottom-right"},lang:{type:String,default:"text"},height:{type:[String,Number],default:"100%"},disableLineWrapping:{type:Boolean,default:!1},disableBorder:{type:Boolean,default:!1},disableLineNumbers:{type:Boolean,default:!1},disableClear:{type:Boolean,default:!1}},{original:{default:""},originalModifiers:{},modified:{default:""},modifiedModifiers:{}}),emits:["update:original","update:modified"],setup(w,{expose:E}){const c=N(w,"original"),m=N(w,"modified"),i=w,V=P(),C=p(null),e=W(null),o=p(!i.disableLineWrapping),M=p(!i.disableLineNumbers),u=p(0),g=p(1),h=p(!1),r=p(!1),k=async()=>{var a;e.value&&([e.value.getOriginalEditor(),e.value.getModifiedEditor()].forEach(t=>{var d;const n=t.getModel();n&&((d=U())==null||d.editor.setModelLanguage(n,Y(i.lang).id))}),e.value.updateOptions({renderSideBySide:!h.value,hideUnchangedRegions:{enabled:r.value}}),(a=U())==null||a.editor.setTheme(V.theme.raw==="dark"?"vs-dark":"vs"))},I=async a=>{e.value&&e.value.dispose(),ie({"vs/nls":{availableLanguages:{"*":$t("main_locale")==="zh_CN"?"zh-cn":"en"}}}).then(t=>{const n=t.editor.createModel(c.value),d=t.editor.createModel(m.value),l=t.editor.createDiffEditor(a,{lineNumbers:M.value?"on":"off",wordWrap:o.value?"on":"off",minimap:{enabled:!1},automaticLayout:!0,originalEditable:!0,scrollBeyondLastLine:!1,renderSideBySide:!h.value,enableSplitViewResizing:!1,hideUnchangedRegions:{enabled:r.value},scrollbar:{verticalScrollbarSize:5}});window._diffEditor=l,l.setModel({original:n,modified:d}),l.getOriginalEditor().onDidChangeModelContent(()=>{l.getOriginalEditor().getValue()!==c.value&&(c.value=l.getOriginalEditor().getValue())}),l.getModifiedEditor().onDidChangeModelContent(()=>{l.getModifiedEditor().getValue()!==m.value&&(m.value=l.getModifiedEditor().getValue())}),[l.getOriginalEditor(),l.getModifiedEditor()].forEach(s=>{new le($t("main_ui_input"),s);const B=new ne(s);B.setHandle("ctool_line_wrapping",(y,T,x)=>o.value=x),B.setHandle("ctool_line_number",(y,T,x)=>M.value=x)}),l.onDidUpdateDiff(()=>{var s;u.value=((s=l.getLineChanges())==null?void 0:s.length)||0,g.value=1}),e.value=l,k()})},D=a=>{var l,s;const t=((l=e.value)==null?void 0:l.getLineChanges())||[];let n=a==="prev"?g.value-1:g.value+1;const d=t.at(n-1);d&&((s=e.value)==null||s.revealLineInCenter(d.originalEndLineNumber),g.value=n)};E({beautifyBoth:async a=>{if(!e.value)return;const t=e.value.getOriginalEditor().getValue(),n=e.value.getModifiedEditor().getValue(),[d,l]=await Promise.all([t?a(i.lang,t):Promise.resolve(t),n?a(i.lang,n):Promise.resolve(n)]);c.value=d,m.value=l}}),j(async()=>{!i.disableClear&&G.addListener("content_clear",()=>L()),await I(C.value)}),J(()=>{var a;return(a=e.value)==null?void 0:a.dispose()});const L=(a="",t="")=>{e.value&&(e.value.getOriginalEditor().getValue()!==a&&e.value.getOriginalEditor().setValue(a),e.value.getModifiedEditor().getValue()!==t&&e.value.getModifiedEditor().setValue(t))};return z(()=>({original:c.value,modified:m.value}),a=>{if(e.value)return L(a.original,a.modified);const t=setInterval(()=>{e.value&&clearInterval(t),L(a.original,a.modified)},50)}),z(()=>({color:V.theme.raw,lang:i.lang,inline:h.value,collapse:r.value}),()=>k()),(a,t)=>{const n=b("Button"),d=b("Input"),l=b("Bool"),s=b("Align"),B=b("Display");return $(),S(B,{position:i.toolbar,right:35,class:"ctool-code-diff",style:K({height:`${f(q)(i.height)}`,width:"100%"}),toggle:""},{extra:_(()=>[v(s,null,{default:_(()=>[v(d,{size:"small",center:"",disabled:u.value===0,"model-value":`${u.value?g.value:0} / ${u.value}`,width:110},{prepend:_(()=>[v(n,{disabled:u.value===0||g.value===1,text:"<",onClick:t[0]||(t[0]=y=>D("prev"))},null,8,["disabled"])]),append:_(()=>[v(n,{disabled:u.value===0||g.value===u.value,text:">",onClick:t[1]||(t[1]=y=>D("next"))},null,8,["disabled"])]),_:1},8,["disabled","model-value"]),v(l,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=y=>r.value=y),label:a.$t("diffs_collapse"),size:"small",border:""},null,8,["modelValue","label"]),v(l,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=y=>h.value=y),label:a.$t("component_editor_inline"),size:"small",border:""},null,8,["modelValue","label"]),Q(a.$slots,"default")]),_:3})]),default:_(()=>[F("div",{ref_key:"container",ref:C,style:{height:"100%",width:"100%"}},null,512)]),_:3},8,["position","style"])}}}),pe=R({__name:"Diffs",async setup(w){let E,c;const m=p(null),i=A(([E,c]=Z(()=>H({original:"",modified:"",option:{lang:"Text"}},{paste:!1})),E=await E,c(),E)),V=ee(()=>O.isEnable(i.current.option.lang,"beautify")),C=async()=>{var e;await((e=m.value)==null?void 0:e.beautifyBoth(async(o,M)=>await O.simple(o,"beautify",M)))};return z(()=>i.current,()=>{i.current.original===""||i.current.modified===""||i.save()},{deep:!0}),(e,o)=>{const M=b("Button"),u=b("Select"),g=b("HeightResize");return $(),S(g,null,{default:_(({height:h})=>[v(oe,{ref_key:"diffRef",ref:m,original:f(i).current.original,"onUpdate:original":o[1]||(o[1]=r=>f(i).current.original=r),modified:f(i).current.modified,"onUpdate:modified":o[2]||(o[2]=r=>f(i).current.modified=r),lang:f(i).current.option.lang,height:`${h}px`},{default:_(()=>[V.value?($(),S(M,{key:0,size:"small",text:e.$t("code_beautify"),onClick:C},null,8,["text"])):te("",!0),v(u,{size:"small",modelValue:f(i).current.option.lang,"onUpdate:modelValue":o[0]||(o[0]=r=>f(i).current.option.lang=r),options:f(ae),filterable:"","filter-placeholder":"Search language..."},null,8,["modelValue","options"])]),_:2},1032,["original","modified","lang","height"])]),_:1})}}});export{pe as default};
