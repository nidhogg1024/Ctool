import{u as L,i as $}from"./action-C9DPVdj4.js";import{d as F,L as V,M as x,D as R,c as z,w,r as f,a as I,x as h,N as C,k as N,j as g,P as W}from"./tool-COZZpXVR.js";import"./modulepreload-polyfill-B5Qt9EMX.js";import"./vendor-mathjs-__1x7LJv.js";import"./vendor-monaco-DSX5bDTJ.js";import"./vendor-lodash-rhkwYG98.js";const Y=F({__name:"SqlFillParameter",async setup(D){let p,E;const d=["String","Integer","Long","Timestamp"],i=L(([p,E]=V(()=>$({input:"",params:""})),p=await p,E(),p)),q=e=>{if(e){const a=e.split(",",-1),o=[];let n=0,l=!1;return a.forEach(r=>{r.endsWith("null")?(o.push(r),n++):r.endsWith(")")?(l?(o[n]+=","+r,l=!1):o.push(r),n++):o[n]?o[n]+=","+r:(o.push(r),l=!0)}),o.map(r=>{const t=r.lastIndexOf("(");if(t<0)return{value:r,type:null};let s=r.substring(0,t);s=s.trim(),s=s.replaceAll("'","\\'");let c=r.lastIndexOf(")");c<0&&(c=r.length);let u=r.substring(t+1,c);return u=u.trim(),{value:s,type:u}})}else return[]},_=e=>{switch(e.type){case d[0]:return" '"+e.value+"'";case d[1]:case d[2]:return e.value;case d[3]:return"Timestamp '"+e.value+"'";default:return e.value}},P=e=>/#\{(\w+)\}/.test(e)?"mybatis":/(^|[^:]):(\w+)/.test(e)?"colon":"positional",y=e=>{const a=new Map;if(!e)return a;const o=e.split(",",-1),n=[];let l=0,r=!1;return o.forEach(t=>{t.endsWith("null")&&t.includes("=")?(n.push(t),l++):t.endsWith(")")?(r?(n[l]+=","+t,r=!1):n.push(t),l++):n[l]?n[l]+=","+t:(n.push(t),r=!0)}),n.forEach(t=>{const s=t.indexOf("=");if(s<0)return;const c=t.substring(0,s).trim(),u=t.substring(s+1),m=u.lastIndexOf("(");if(m<0){a.set(c,{value:u.trim(),type:null});return}let S=u.substring(0,m).trim();S=S.replaceAll("'","\\'");const v=u.lastIndexOf(")"),A=u.substring(m+1,v<0?u.length:v).trim();a.set(c,{value:S,type:A})}),a},b=()=>{if(!i.current.input||!i.current.params)return"";const e=P(i.current.input);if(e==="colon"||e==="mybatis"){const r=y(i.current.params);let t=i.current.input;return e==="mybatis"?t=t.replace(/#\{(\w+)\}/g,(s,c)=>{const u=r.get(c);if(!u)throw new Error($t("sqlFillParameter_named_param_missing").replace("{name}",c));return _(u)}):t=t.replace(/(::?)(\w+)/g,(s,c,u)=>{if(c==="::")return s;const m=r.get(u);if(!m)throw new Error($t("sqlFillParameter_named_param_missing").replace("{name}",u));return _(m)}),t}const a=q(i.current.params),o=i.current.input;let n="",l=0;for(let r=0;r<o.length;r++){const t=o.charAt(r);if(t==="?"){if(a.length<=l)throw new Error($t("sqlFillParameter_parameter_too_little"));n+=_(a[l]),l++}else n+=t}return n},O=e=>{const a={sql:"",params:""},o="Preparing:";let n=e.indexOf(o);n<0?n=0:n+=o.length;let l=e.indexOf(`
`,n);l<0&&(l=e.length),a.sql=e.substring(n,l);const r="Parameters:",t=e.indexOf(r);if(t>=0){let s=e.indexOf(`
`,t);s<0&&(s=e.length),a.params=e.substring(t+r.length,s)}return a},T=x(()=>{try{if(!i.current.input||!i.current.params)return"";const e=b();return i.save(),e}catch(e){return $error(e)}});return R(()=>({input:i.current.input,params:i.current.params}),({input:e})=>{if(e!==""&&e.includes("Preparing:")&&e.includes("Parameters:")){const a=O(e);a.sql!==""&&a.params!==""&&setTimeout(()=>{i.current.input=a.sql,i.current.params=a.params})}},{immediate:!0}),(e,a)=>{const o=f("Editor"),n=f("Textarea"),l=f("Align"),r=f("HeightResize"),t=W("row");return I(),z(r,{ignore:"",reduce:5},{default:w(({height:s})=>[h(l,{direction:"vertical"},{default:w(()=>[C((I(),N("div",null,[h(o,{modelValue:g(i).current.input,"onUpdate:modelValue":a[0]||(a[0]=c=>g(i).current.input=c),lang:"sql",height:s/2,placeholder:"Sql: SELECT * FROM T WHERE id=? AND name=?"},null,8,["modelValue","height"]),h(n,{modelValue:g(i).current.params,"onUpdate:modelValue":a[1]||(a[1]=c=>g(i).current.params=c),height:s/2,placeholder:`${e.$t("sqlFillParameter_parameter")}:
?模式: 1(Integer),zhangshan(String)
具名模式: id=1(Integer),name=zhangshan(String)`,copy:e.$t("sqlFillParameter_parameter")},null,8,["modelValue","height","placeholder","copy"])])),[[t,"1-1"]]),h(o,{"model-value":T.value,lang:"sql",height:s/2,placeholder:`${e.$t("main_ui_output")}: SELECT * FROM T WHERE id=1 AND name='zhangshan'`},null,8,["model-value","height","placeholder"])]),_:2},1024)]),_:1})}}});export{Y as default};
