var N=Object.defineProperty;var w=(e,t,n)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var d=(e,t,n)=>w(e,typeof t!="symbol"?t+"":t,n);import{V as c,R as m,U as b}from"./tool-BLEDneDs.js";import{b as f,m as C,e as D}from"./vendor-monaco-DSX5bDTJ.js";const M=()=>[{id:"ctool_multiple_selection",label:$t("component_editor_multiple"),contextMenuGroupId:"1_modification",enable:!0,run:(e,t)=>{e.trigger(t,"editor.action.insertCursorAtEndOfEachLineSelected","")}},{id:"ctool_search",label:$t("component_editor_search"),contextMenuGroupId:"1_modification",enable:!0,run:(e,t)=>{e.trigger(t,"editor.action.startFindReplaceAction",null)}},{id:"ctool_goto",label:$t("component_editor_goto"),contextMenuGroupId:"1_modification",enable:!0,run:e=>e.trigger("","editor.action.gotoLine",null)},{id:"ctool_beautify",label:$t("code_beautify"),run:async e=>{var r;const t=((r=e.getModel())==null?void 0:r.getLanguageId())||"";if(!c.isEnable(t,"beautify")||e.getValue()==="")return;const n=await c.simple(t,"beautify",e.getValue());n!==e.getValue()&&e.setValue(n)}},{id:"ctool_compress",label:$t("code_compress"),run:async e=>{var r;const t=((r=e.getModel())==null?void 0:r.getLanguageId())||"";if(!c.isEnable(t,"compress")||e.getValue()==="")return;const n=await c.simple(t,"compress",e.getValue());n!==e.getValue()&&e.setValue(n)}},{id:"ctool_line_wrapping",label:$t("component_editor_line_wrapping"),enable:!0,run:e=>(e.updateOptions({wordWrap:e.getRawOptions().wordWrap==="off"?"on":"off"}),e.getRawOptions().wordWrap==="on")},{id:"ctool_line_number",label:$t("component_editor_line_number"),enable:!0,run:e=>(e.updateOptions({lineNumbers:e.getRawOptions().lineNumbers==="off"?"on":"off"}),e.getRawOptions().lineNumbers==="on")}];class A{constructor(t){d(this,"editor");d(this,"handles",{});d(this,"_disposed",!1);this.editor=t,this.initMenu(),this.editor.onDidChangeModelLanguage(n=>{this.toggle("ctool_beautify",c.isEnable(n.newLanguage,"beautify")),this.toggle("ctool_compress",c.isEnable(n.newLanguage,"compress")),this.removeDefaultMenu()}),this.removeDefaultMenu(),this.editor.onDidDispose(()=>{this._disposed=!0})}removeDefaultMenu(){setTimeout(()=>{this._disposed||(this.editor.createContextKey("editorHasDocumentFormattingProvider",!1),this.editor.createContextKey("editorHasReferenceProvider",!1),this.editor.createContextKey("editorHasDefinitionProvider",!1),this.editor.createContextKey("editorHasDocumentSelectionFormattingProvider",!1),this.editor.createContextKey("editorHasMultipleDocumentFormattingProvider",!1),this.editor.createContextKey("editorHasMultipleDocumentSelectionFormattingProvider",!1))},200)}initMenu(){let t=1e3;M().forEach(n=>{const r={id:n.id,precondition:n.id,label:n.label,contextMenuGroupId:n.contextMenuGroupId||"ctool",contextMenuOrder:t++,run:o=>{var a,i,s,l;if(n.run){const u=n.run(o,n.id);(i=(a=this.handles)[n.id])==null||i.call(a,o,n.id,u);return}(l=(s=this.handles)[n.id])==null||l.call(s,o,n.id)}};this.toggle(n.id,!!n.enable),this.editor.addAction(r)})}setHandle(t,n){this.handles[t]=n}toggle(t,n){return this.editor.createContextKey(t,n)}}const I=(e,t)=>{var a;const n=m.trimEnd((a=t.getModel())==null?void 0:a.getValueInRange({startLineNumber:e.startLineNumber,endLineNumber:e.endLineNumber+1,startColumn:e.startColumn-1,endColumn:Number.MAX_SAFE_INTEGER}),",");let r="";try{if(["{","["].includes(n[0]))r=b.parse(n,{JSON_REPAIR:!0});else{const i=b.parse(`{${n}}`,{JSON_REPAIR:!0});m.isPlainObject(i)&&Object.keys(i).length>0&&(r=i[Object.keys(i)[0]])}}catch{}let o=0;m.isArray(r)&&(o=r.length),m.isPlainObject(r)&&(o=Object.keys(r).length),!(o<1)&&t.createDecorationsCollection([{range:{startColumn:0,endColumn:Number.MAX_SAFE_INTEGER,startLineNumber:e.startLineNumber,endLineNumber:e.startLineNumber},options:{after:{content:`${o}`,inlineClassName:"ctool-monaco-editor-line-info"}}}])},L=e=>{var o,a,i;const t=e.getVisibleRanges();if(t.length===0)return;const n=t[0];for(let s=n.startLineNumber;s<=n.endLineNumber;s++)(o=e.getLineDecorations(s))==null||o.filter(l=>{var u,p;return(p=(u=l.options.after)==null?void 0:u.inlineClassName)==null?void 0:p.includes("ctool-monaco-editor-line-info")}).forEach(l=>{e.removeDecorations([l.id])});if(((a=e.getModel())==null?void 0:a.getLanguageId())!=="json")return;(((i=e.getDecorationsInRange(n))==null?void 0:i.filter(s=>{var l,u;return(u=(l=s.options)==null?void 0:l.firstLineDecorationClassName)==null?void 0:u.includes("codicon-folding-")}))||[]).filter(s=>s.range.startLineNumber>=n.startLineNumber&&s.range.startLineNumber<=n.endLineNumber).forEach(s=>{I(s.range,e)})},y=m.debounce(e=>{setTimeout(()=>L(e),100)},300);class E{constructor(t){d(this,"editor");d(this,"_status",!1);this.editor=t,this.init()}init(){this.editor.onDidScrollChange(()=>this.render()),this.editor.onDidChangeModelLanguage(()=>this.render()),this.editor.onDidChangeModel(()=>this.render()),this.editor.onDidChangeModelContent(()=>this.render()),setTimeout(()=>this.render(),500)}status(t){var n;if(this._status=t,this.render(),!this._status){const r=((n=this.editor.getModel())==null?void 0:n.getAllDecorations().filter(o=>{var a,i;return(i=(a=o.options.after)==null?void 0:a.inlineClassName)==null?void 0:i.includes("ctool-monaco-editor-line-info")}).map(o=>o.id))||[];r.length>0&&this.editor.removeDecorations(r)}}render(){if(this._status)return y(this.editor)}}const h=new Map,P=e=>{if(!h.has(e.getId())){const t=e.getId();h.set(t,new E(e)),e.onDidDispose(()=>{h.delete(t)})}return h.get(e.getId())};function x(e){return new Worker(""+new URL("editor.worker-DIGN4I7K.js",import.meta.url).href,{name:e==null?void 0:e.name})}function R(e){return new Worker(""+new URL("json.worker-Cr6Fbx-E.js",import.meta.url).href,{name:e==null?void 0:e.name})}function W(e){return new Worker(""+new URL("css.worker-JcJk4I_E.js",import.meta.url).href,{name:e==null?void 0:e.name})}function k(e){return new Worker(""+new URL("html.worker-SBFHES3q.js",import.meta.url).href,{name:e==null?void 0:e.name})}function v(e){return new Worker(""+new URL("ts.worker-D075-c84.js",import.meta.url).href,{name:e==null?void 0:e.name})}self.MonacoEnvironment={getWorker(e,t){return t==="json"?new R:t==="css"||t==="scss"||t==="less"?new W:t==="html"||t==="handlebars"||t==="razor"?new k:t==="typescript"||t==="javascript"?new v:new x}};const V=()=>f.__getMonacoInstance(),S=(e={})=>(f.config({monaco:C,...e}),f.init()),g=class g{constructor(t,n){d(this,"domNode");this.placeholder=t,this.editor=n,n.onDidChangeModelContent(()=>this.onDidChangeModelContent()),this.onDidChangeModelContent()}onDidChangeModelContent(){this.editor.getValue()===""?this.editor.addContentWidget(this):this.editor.removeContentWidget(this)}getId(){return g.ID}getDomNode(){return this.domNode||(this.domNode=document.createElement("div"),this.domNode.style.width="max-content",this.domNode.style.pointerEvents="none",this.domNode.textContent=this.placeholder,this.domNode.style.fontStyle="italic",this.editor.applyFontInfo(this.domNode)),this.domNode}getPosition(){return{position:{lineNumber:1,column:1},preference:[D.ContentWidgetPositionPreference.EXACT]}}dispose(){this.editor.removeContentWidget(this)}};d(g,"ID","editor.widget.placeholderHint");let _=g;export{_ as P,S as a,A as c,P as l,V as m};
