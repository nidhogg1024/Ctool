import{u as B,i as W}from"./action-BZ3Nddn_.js";import{d as D,L as U,A as E,M as I,D as X,c as Y,w as C,r as A,a as u,x as M,j as h,k as d,v as o,F as k,q as x,l as m,m as b,G as K,a1 as Z,az as Q}from"./tool-BLEDneDs.js";import"./modulepreload-polyfill-B5Qt9EMX.js";import"./vendor-mathjs-__1x7LJv.js";import"./vendor-monaco-DSX5bDTJ.js";import"./vendor-lodash-rhkwYG98.js";const T=/^\s*at\s+(.+)\(([^:]+):(\d+)\)\s*$/,ee=/^\s*at\s+(.+)\((.+)\)\s*$/,N=/^([\w$.]+(?:Exception|Error|Throwable)[^:]*):?\s*(.*)/,te=/^\s*File\s+"([^"]+)",\s*line\s+(\d+)(?:,\s*in\s+(.+))?/,se=/^(\w+(?:Error|Exception|Warning)[^:]*):?\s*(.*)/,S=/^\s*at\s+(.+?)\s+\((.+?):(\d+):\d+\)\s*$/,ae=/^\s*at\s+(.+?):(\d+):\d+\s*$/,R=/^(\w*Error):\s*(.*)/,J=/^\s+(.+?):(\d+)(?:\s|$)/,ne=/^\s*at\s+(.+?)\s+in\s+(.+?):line\s+(\d+)/,re=/^(.+?):(\d+):in\s+[`'](.+?)'/,ce=/^\s*#\d+\s+(.+?)\((\d+)\):\s*(.+)/,j=/^\s+at\s+(.+?):(\d+)(?::\d+)?$/,oe=["stacktrace","stack_trace","stackTrace","stack","traceback","error_stack","backtrace","error.stack","error.stack_trace"],G=s=>{if(typeof s!="object"||s===null)return null;for(const e of oe)if(e.includes(".")){const t=e.split(".");let a=s;for(const n of t)if(a&&typeof a=="object"&&n in a)a=a[n];else{a=void 0;break}if(typeof a=="string"&&(a.includes(`
`)||a.includes("\\n")))return a}else if(e in s&&typeof s[e]=="string"){const t=s[e];if(t.includes(`
`)||t.includes("\\n"))return t}for(const e of Object.keys(s))if(typeof s[e]=="object"&&s[e]!==null&&!Array.isArray(s[e])){const t=G(s[e]);if(t)return t}return null},ie=s=>{var n;const e=s.jsonPayload||s.payload||s,t={};if(e.msg&&(t.message=e.msg),e.message&&e.message!==e.msg&&(t.message=e.message),e.error&&(t.error=e.error),e.level&&(t.level=e.level),e.caller&&(t.caller=e.caller),(e.trace_id||e.traceId)&&(t.trace_id=e.trace_id||e.traceId),(e.request_id||e.requestId)&&(t.request_id=e.request_id||e.requestId),e.url||e.path){const c=e.method||"",i=e.url||e.path;t.request=`${c} ${i}`.trim()}e.client_ip&&(t.client_ip=e.client_ip),s.timestamp&&(t.timestamp=s.timestamp);const a=s.resource;return(n=a==null?void 0:a.labels)!=null&&n.service_name&&(t.service=a.labels.service_name),Object.keys(t).length>0?t:void 0},le=s=>{const e=s.trim();if(e.startsWith("{"))try{const t=JSON.parse(e),a=G(t);if(a)return{stackText:a.includes("\\n")?a.replace(/\\n/g,`
`).replace(/\\t/g,"	"):a,meta:ie(t)}}catch{}return e.includes("\\n")?{stackText:e.replace(/\\n/g,`
`).replace(/\\t/g,"	")}:{stackText:e}},fe=s=>{const e={language:"Java",exception:"",message:"",frames:[]};for(const t of s){const a=t.match(N);if(a&&!e.exception){e.exception=a[1],e.message=a[2]||"";continue}const n=t.match(T);if(n){e.frames.push({method:n[1],file:n[2],line:n[3],raw:t.trim()});continue}const c=t.match(ee);c&&e.frames.push({method:c[1],file:c[2],line:"-",raw:t.trim()})}return e},me=s=>{const e={language:"Python",exception:"",message:"",frames:[]};for(const t of s){const a=t.match(se);if(a){e.exception=a[1],e.message=a[2]||"";continue}const n=t.match(te);n&&e.frames.push({file:n[1],line:n[2],method:n[3]||"<module>",raw:t.trim()})}return e},L=s=>{const e={language:"JavaScript",exception:"",message:"",frames:[]};for(const t of s){const a=t.match(R);if(a&&!e.exception){e.exception=a[1],e.message=a[2]||"";continue}const n=t.match(S);if(n){e.frames.push({method:n[1],file:n[2],line:n[3],raw:t.trim()});continue}const c=t.match(ae);c&&e.frames.push({method:"<anonymous>",file:c[1],line:c[2],raw:t.trim()})}return e},ue=s=>{const e={language:"Go",exception:"",message:"",frames:[]};if(s.length>0){const t=s[0].trim();t.startsWith("goroutine")?(e.exception="goroutine",e.message=t):t.startsWith("panic:")&&(e.exception="panic",e.message=t.replace("panic:","").trim())}for(let t=0;t<s.length;t++){const a=s[t].match(J);if(a){const c=(t>0?s[t-1].trim():"").replace(/\(.*\)$/,"");e.frames.push({method:c||"-",file:a[1],line:a[2],raw:s[t].trim()})}}return e},de=s=>{const e=s.trim();if(!e)return null;let t;if(t=e.match(ne),t)return{method:t[1],file:t[2],line:t[3],raw:e};if(t=e.match(re),t)return{method:t[3],file:t[1],line:t[2],raw:e};if(t=e.match(ce),t)return{method:t[3],file:t[1],line:t[2],raw:e};if(t=e.match(j),t)return{method:"-",file:t[1],line:t[2],raw:e};if(t=e.match(T),t)return{method:t[1],file:t[2],line:t[3],raw:e};if(t=e.match(S),t)return{method:t[1],file:t[2],line:t[3],raw:e};if(t=e.match(/^(.+?)@(.+?):(\d+)(?::\d+)?$/),t)return{method:t[1]||"-",file:t[2],line:t[3],raw:e};if(t=e.match(/((?:\/|\.\.?\/|[A-Z]:\\)[^\s:()]+?\.[a-z0-9]{1,10}):(\d+)/i),t){const a=e.indexOf(t[0]);return{method:e.substring(0,a).trim().replace(/^(at|in|from|#\d+)\s+/i,"").replace(/[()]+$/,"").trim()||"-",file:t[1],line:t[2],raw:e}}if(t=e.match(/\b([\w.-]+\.[a-z]{1,10}):(\d+)\b/i),t){const a=e.indexOf(t[0]);return{method:e.substring(0,a).trim().replace(/^(at|in|from|#\d+)\s+/i,"").replace(/[()]+$/,"").trim()||"-",file:t[1],line:t[2],raw:e}}return null},O=s=>{const e={language:"Generic",exception:"",message:"",frames:[]};for(let t=0;t<Math.min(3,s.length);t++){const a=s[t].trim(),n=a.match(/^([\w.]+(?:Exception|Error|Fault|Panic|Warning)[^:]*):?\s*(.*)/);if(n){e.exception=n[1],e.message=n[2]||"";break}const c=a.match(/^thread\s+'(.+?)'\s+panicked\s+at\s+'(.+?)'/);if(c){e.exception="panic",e.message=c[2];break}const i=a.match(/^PHP\s+(\w+\s+\w+):\s*(.*)/);if(i){e.exception=i[1],e.message=i[2];break}}for(let t=0;t<s.length;t++){const a=s[t].match(/^\s*(\d+):\s+(.+)$/);if(a&&t+1<s.length){const i=s[t+1].match(j);if(i){e.frames.push({method:a[2],file:i[1],line:i[2],raw:s[t].trim()}),t++;continue}}const n=s[t].match(J);if(n){const g=(t>0?s[t-1].trim():"").replace(/\(.*\)$/,"");if(g&&!g.match(/^\d+:/)&&!g.match(/^(at|in|from)\s/i)){e.frames.push({method:g,file:n[1],line:n[2],raw:s[t].trim()});continue}}const c=de(s[t]);c&&e.frames.push(c)}return e.frames.length>0&&(e.language=pe(e.frames)),e},pe=s=>{const e={};for(const c of s){const i=c.file.match(/\.([a-z0-9]+)$/i);if(i){const g=i[1].toLowerCase();e[g]=(e[g]||0)+1}}let t="",a=0;for(const[c,i]of Object.entries(e))i>a&&(t=c,a=i);return{java:"Java",kt:"Kotlin",scala:"Scala",groovy:"Groovy",py:"Python",js:"JavaScript",ts:"TypeScript",jsx:"JavaScript",tsx:"TypeScript",mjs:"JavaScript",go:"Go",cs:"C#",fs:"F#",vb:"VB.NET",rb:"Ruby",erb:"Ruby",php:"PHP",rs:"Rust",swift:"Swift",c:"C",cpp:"C++",cc:"C++",cxx:"C++",h:"C/C++",ex:"Elixir",exs:"Elixir",erl:"Erlang",lua:"Lua",r:"R",pl:"Perl",pm:"Perl"}[t]||"Generic"},he=s=>/^\s*File\s+"/m.test(s)?"python":s.includes("goroutine")||s.includes("panic:")||/^\t.+?:\d+/m.test(s)?"go":S.test(s)||R.test(s)?"javascript":T.test(s)||N.test(s)||s.includes("	at ")?"java":/\n\s+\/.+?:\d+/.test(s)?"go":"generic",ge=s=>{const e=s.split(`
`);switch(he(s)){case"java":return fe(e);case"python":return me(e);case"javascript":return L(e);case"go":return ue(e);case"generic":{const a=O(e);return a.frames.length===0?L(e):a}default:return O(e)}},_e={key:0,class:"st-card st-meta"},ve={class:"st-meta-table"},ke=["onClick"],we={class:"st-meta-key"},ye=["title"],xe={class:"st-title-bar"},be={class:"st-title-left"},$e={class:"st-lang-badge"},Ee={key:0,class:"st-exc-name"},Ce={class:"st-count"},Ae=["title"],Me={class:"st-card st-frame-list"},Te=["onClick","title"],Se={class:"st-row-body"},Pe={class:"st-row-file"},Fe={class:"st-row-sep"},Ie={class:"st-row-fn"},Le={class:"st-row-sep"},Oe={class:"st-row-line"},Ne=["onClick"],Re={class:"st-collapse-text"},Je=["onClick"],je={class:"st-collapse-text"},Ge=["onClick","title"],Ve={class:"st-row-body"},ze={class:"st-row-file"},He={class:"st-row-sep"},qe={class:"st-row-fn"},Be={class:"st-row-sep"},We={class:"st-row-line"},De=D({__name:"Stacktrace",async setup(s){let e,t;const a=B(([e,t]=U(()=>W({input:""})),e=await e,t(),e));let n=E(null),c=E(void 0),i=E([]);const g=I(()=>c.value?Object.entries(c.value):[]),V=I(()=>n.value?n.value.frames.filter(r=>P(r)).length:0),P=r=>{const f=`${r.file} ${r.method}`.toLowerCase();return!["java.lang","java.util","sun.reflect","org.springframework","javax.","jdk.","native method","java.net","java.io","node_modules","node:internal","webpack","vite","react-dom","zone.js","next/dist","site-packages","lib/python","django/","flask/","importlib","runtime/","net/http","google.golang.org/grpc","github.com/newrelic","github.com/getsentry","/go/pkg/mod/","system.","microsoft.","gems/","ruby/","vendor/","<native>","<anonymous>"].some(v=>f.includes(v))},z=r=>{const f=[];let _=null;return r.forEach((v,$)=>{const w=P(v)?"business":"framework";w!==_&&(f.push(Z({type:w,frames:[],expanded:!1})),_=w),f[f.length-1].frames.push({idx:$+1,frame:v})}),f},F=r=>{if(!r||r==="-")return{pkg:"",fn:r||"-"};const f=Math.max(r.lastIndexOf("."),r.lastIndexOf("::"));return f>0&&f<r.length-1?{pkg:r.substring(0,f+1),fn:r.substring(f+1)}:{pkg:"",fn:r}};return X(()=>a.current.input,r=>{const f=r.trim();if(!f){n.value=null,c.value=void 0,i.value=[];return}const _=le(f);c.value=_.meta,n.value=ge(_.stackText),n.value.frames.length>0&&(i.value=z(n.value.frames),a.save())},{immediate:!0}),(r,f)=>{const _=A("Textarea"),v=A("Align"),$=A("HeightResize");return u(),Y(v,{direction:"vertical"},{default:C(()=>[M($,{reduce:5},{default:C(({small:w,large:H})=>[M(v,{direction:"vertical"},{default:C(()=>[M(_,{modelValue:h(a).current.input,"onUpdate:modelValue":f[0]||(f[0]=p=>h(a).current.input=p),height:w,placeholder:r.$t("stacktrace_input_placeholder")},null,8,["modelValue","height","placeholder"]),h(n)&&h(n).frames.length>0?(u(),d("div",{key:0,style:K({height:`${H}px`,overflow:"auto"})},[g.value.length>0?(u(),d("div",_e,[o("table",ve,[o("tbody",null,[(u(!0),d(k,null,x(g.value,([p,y])=>(u(),d("tr",{key:p,onClick:l=>r.$copy(y)},[o("td",we,m(p),1),o("td",{class:"st-meta-val",title:y},m(y),9,ye)],8,ke))),128))])])])):b("",!0),o("div",xe,[o("div",be,[o("span",$e,m(h(n).language),1),h(n).exception?(u(),d("span",Ee,m(h(n).exception),1)):b("",!0)]),o("span",Ce,m(V.value)+" / "+m(h(n).frames.length)+" frames",1)]),h(n).message?(u(),d("div",{key:1,class:"st-exc-msg",title:h(n).message},m(h(n).message),9,Ae)):b("",!0),o("div",Me,[(u(!0),d(k,null,x(h(i),(p,y)=>(u(),d(k,{key:y},[p.type==="business"?(u(!0),d(k,{key:0},x(p.frames,l=>(u(),d("div",{key:l.idx,class:"st-row st-row-app",onClick:q=>r.$copy(`${l.frame.file}:${l.frame.line}`),title:`${l.frame.file}:${l.frame.line}`},[o("div",Se,[o("span",Pe,m(l.frame.file),1),o("span",Fe,m(r.$t("stacktrace_at")),1),o("span",Ie,m(F(l.frame.method).fn),1),o("span",Le,m(r.$t("stacktrace_line")),1),o("span",Oe,m(l.frame.line),1)]),f[1]||(f[1]=o("span",{class:"st-badge-app"},"In App",-1))],8,Te))),128)):(u(),d(k,{key:1},[p.expanded?(u(),d(k,{key:1},[o("div",{class:"st-collapse-bar",onClick:l=>p.expanded=!1},[o("span",je,m(r.$t("stacktrace_hide_frames")),1)],8,Je),(u(!0),d(k,null,x(p.frames,l=>(u(),d("div",{key:l.idx,class:"st-row st-row-fw",onClick:q=>r.$copy(`${l.frame.file}:${l.frame.line}`),title:`${l.frame.file}:${l.frame.line}`},[o("div",Ve,[o("span",ze,m(l.frame.file),1),o("span",He,m(r.$t("stacktrace_at")),1),o("span",qe,m(F(l.frame.method).fn),1),o("span",Be,m(r.$t("stacktrace_line")),1),o("span",We,m(l.frame.line),1)])],8,Ge))),128))],64)):(u(),d("div",{key:0,class:"st-collapse-bar",onClick:l=>p.expanded=!0},[o("span",Re,m(r.$t("stacktrace_show_n_frames",{n:p.frames.length})),1)],8,Ne))],64))],64))),128))])],4)):b("",!0)]),_:2},1024)]),_:1})]),_:1})}}}),et=Q(De,[["__scopeId","data-v-1d701a5d"]]);export{et as default};
