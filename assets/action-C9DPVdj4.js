import{u as b,a0 as k,e as S,a1 as z,R as n,a2 as D,a3 as x,a4 as H,a5 as w,a6 as W,a7 as R,a8 as T,a9 as $,p as j,aa as O,ab as E}from"./tool-COZZpXVR.js";const q=async(i,{input:e="input",keyword:h=u=>!1,paste:y=u=>!0}={})=>{const u=b(),f=k(u.items.tool,u.items.feature),g=E(),_=S(),a=t=>{var v;const c=(v=g.query)==null?void 0:v[t];return n.isString(c)?c:""},s=(()=>{const t=a("keyword");return t===""?!1:h(t)})(),r=t=>(e&&n.isNumber(i[e])&&t[e]&&(t[e]=n.toNumber(t[e])),{items:n.cloneDeep(t),field:e});e&&!(e in i)&&(e="",y=!1);const p=e&&R(i[e]);i=s?n.merge(i,s):i;const o=n.cloneDeep(i);if(e){const t=T.get("_temp_input_storage")||a("input");if(t!=="")return p?(o[e].value=t,r(o)):r({...o,[e]:t})}const I=a("history")!==""?f.get(parseInt(a("history"))):null;if(I)return r(n.mergeWith(o,I,(t,c)=>{if(x(t))return t.unserialize(c)}));const l=(()=>{if(f.length()<1)return null;if(s){const t=f.all();for(const c in t)if($(s,t[c].v))return f.getWithTime(parseInt(c));return null}return f.getWithTime(0)})(),m=await(async()=>{if(e&&y!==!1&&_.items.auto_read_copy){const t=await j();if(t.trim()&&y(t))return _.items.auto_read_copy_filter?t.trim():t}return""})();return l&&(m===""||O().unix()-O(l.t).unix()<_.items.fill_history_expire)?(console.log("use latest history data"),r(n.mergeWith(o,l.v,(t,c)=>{if(x(t))return t.unserialize(c)}))):m?(console.log("use paste data"),p?(o[e].value=_.items.auto_read_copy_filter?m.trim():m,r(o)):r({...o,[e]:_.items.auto_read_copy_filter?m.trim():m})):r(o)},A=i=>{const e=b(),h=k(e.items.tool,e.items.feature),y=S(),u=z(i.items),f=n.debounce(()=>{const a=s=>{if(!n.isObject(s))return s;if(x(s)){if(!s.isSaveHistory())throw new Error("Do not save");return s.serialize()}for(const r in s)s[r]=a(s[r]);return s};try{h.push(a(n.cloneDeep(D(u))))}catch{}},500),g=()=>{f()};return{current:u,save:g,success:({message:a=$t("main_ui_success"),message_type:s="success",copy_text:r="",copy_image:p="",is_save:o=!0}={})=>{if(o&&g(),r!==""&&y.items.auto_save_copy)return H(r,()=>{w.success($t("main_ui_copy_text_ok"))});if(p!==""&&y.items.auto_save_copy)return W(p,()=>{w.success($t("main_ui_copy_image_ok"))});a!==""&&w[s](a,{offset:150})}}};export{q as i,A as u};
