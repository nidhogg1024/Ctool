import{u as w,i as D}from"./action-C9DPVdj4.js";import{d as T,L as $,M as E,T as a,D as I,c as A,w as i,r as l,x as o,N as C,k as H,j as n,Q as U,O as g,P as z,a as h}from"./tool-COZZpXVR.js";import{a as O}from"./index-CPoQnu_J.js";import"./modulepreload-polyfill-B5Qt9EMX.js";import"./vendor-mathjs-__1x7LJv.js";import"./vendor-monaco-DSX5bDTJ.js";import"./vendor-lodash-rhkwYG98.js";import"./vendor-crypto-Bb1b9cxO.js";const M=T({__name:"Verify",async setup(R){let s,c;const e=w(([s,c]=$(()=>D({sourceData:g("text"),signValue:g("hex"),option:{public_key:"",user_id:"1234567812345678"},output:U("text")})),s=await s,c(),s)),m=E(()=>{if(e.current.sourceData.text.isEmpty()||e.current.signValue.text.isEmpty()||e.current.option.public_key==="")return a.empty();if(e.current.sourceData.text.isError())return e.current.sourceData.text;if(e.current.signValue.text.isError())return e.current.signValue.text;try{let t=e.current.option.public_key;if(t.length==128)t="04"+t;else if(t.length!=130||!t.startsWith("04"))return a.fromError($error($t("public_key_error")));return O.sm2.doVerifySignature(e.current.sourceData.text.toArray(),e.current.signValue.text.toHexString(),t,{hash:!0,userId:e.current.option.user_id})?a.fromString($t("sign_verify_ok")):a.fromString($t("sign_verify_fail"))}catch(t){return a.fromError($error(t))}});return I(()=>m.value,t=>{t.isEmpty()||e.save()},{immediate:!0,deep:!0}),(t,r)=>{const d=l("TextInput"),_=l("Input"),p=l("Align"),V=l("HelpTip"),x=l("Card"),y=l("TextOutput"),v=l("HeightResize"),b=z("row");return h(),A(v,{ignore:"",append:[".ctool-page-option"],reduce:10},{default:i(({small:k,large:f})=>[o(p,{direction:"vertical"},{default:i(()=>[C((h(),H("div",null,[o(d,{modelValue:n(e).current.sourceData,"onUpdate:modelValue":r[0]||(r[0]=u=>n(e).current.sourceData=u),height:f,placeholder:t.$t("sm2_source_data"),upload:"file"},null,8,["modelValue","height","placeholder"]),o(d,{modelValue:n(e).current.signValue,"onUpdate:modelValue":r[1]||(r[1]=u=>n(e).current.signValue=u),height:f,placeholder:t.$t("sm2_sign_value"),allow:["hex","base64"]},null,8,["modelValue","height","placeholder"])])),[[b,"1-1"]]),o(x,{title:t.$t("main_ui_config"),class:"ctool-page-option"},{extra:i(()=>[o(p,null,{default:i(()=>[o(V,{link:"https://github.com/JuneAndGreen/sm-crypto"})]),_:1})]),default:i(()=>[o(p,{horizontal:"center"},{default:i(()=>[o(_,{modelValue:n(e).current.option.public_key,"onUpdate:modelValue":r[2]||(r[2]=u=>n(e).current.option.public_key=u),label:t.$t("sm2_public_key")},null,8,["modelValue","label"]),o(_,{modelValue:n(e).current.option.user_id,"onUpdate:modelValue":r[3]||(r[3]=u=>n(e).current.option.user_id=u),label:t.$t("sm2_userId")},null,8,["modelValue","label"])]),_:1})]),_:1},8,["title"]),o(y,{modelValue:n(e).current.output,"onUpdate:modelValue":r[4]||(r[4]=u=>n(e).current.output=u),allow:["hex"],content:m.value,height:k},null,8,["modelValue","content","height"])]),_:2},1024)]),_:1})}}});export{M as default};
